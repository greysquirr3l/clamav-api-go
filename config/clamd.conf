# ClamAV Daemon Configuration - Optimized for API Gateway
# Optimized configuration for production deployment with ClamAV API Go

# Logging and debugging
LogFile /var/log/clamav/clamd.log
LogFileUnlock yes
LogFileMaxSize 10M
LogRotate yes
LogTime yes
LogClean yes
LogSyslog yes

# Extended detection information - RECOMMENDED by Arch Linux wiki
ExtendedDetectionInfo yes

# Local socket (commented out - using TCP for API gateway)
# LocalSocket /var/run/clamav/clamd.ctl

# TCP socket configuration - Required for API gateway
# SECURITY NOTE: ClamAV daemon is protected by API gateway authentication
# Direct access to ClamAV daemon should be restricted by network policies
TCPSocket 3310
TCPAddr 0.0.0.0

# Connection limits for high-throughput API usage
MaxConnectionQueueLength 200
MaxThreads 20

# Timeout settings optimized for API requests
ReadTimeout 300
CommandReadTimeout 30

# User configuration
User clamav

# Scanning options optimized for API usage
ScanPE yes
ScanELF yes
ScanOLE2 yes
ScanPDF yes
ScanSWF yes
ScanXMLDOCS yes
ScanHWP3 yes
ScanOneNote yes
ScanMail yes
ScanHTML yes
ScanArchive yes

# Archive and compression format scanning
ScanRAR yes

# Enhanced malware detection - RECOMMENDED by Arch Linux wiki
DetectBrokenExecutables yes

# Limits to prevent resource exhaustion
MaxScanTime 120000
MaxScanSize 150M
MaxFileSize 100M
MaxRecursion 20
MaxFiles 15000
MaxEmbeddedPE 40M
MaxHTMLNormalize 40M
MaxHTMLNoTags 8M
MaxScriptNormalize 20M
MaxZipTypeRcg 1M

# Archive limits
MaxDirectoryRecursion 20

# Enhanced detection settings - RECOMMENDED by Arch Linux wiki
DetectPUA yes
HeuristicAlerts yes
AlertBrokenExecutables yes
AlertBrokenMedia yes
AlertEncrypted yes
AlertEncryptedArchive yes
AlertEncryptedDoc yes
AlertOLE2Macros yes
AlertPartitionIntersection yes

# Temporary directory
TemporaryDirectory /tmp

# Database directory
DatabaseDirectory /var/lib/clamav

# Official database only for production stability
OfficialDatabaseOnly no

# Cross filesystem scanning
CrossFilesystems yes

# Follow directory symlinks
FollowDirectorySymlinks no

# Follow file symlinks 
FollowFileSymlinks no

# Self-check frequency (3600 seconds = 1 hour)
SelfCheck 3600

# Disable potentially risky features for production
DisableCertCheck no

# Algorithm detection
AlgorithmicDetection yes

# Scan options for performance
ScanOnAccess no

# Bytecode security
Bytecode yes
BytecodeSecurity TrustSigned
BytecodeTimeout 10000

# Performance tuning
DetectPUA no
ScanPartialMessages no

# Exit on out of memory
ExitOnOOM yes

# Foreground mode (useful for containerized deployments)
Foreground yes

# Process ID file
PidFile /var/run/clamav/clamd.pid

# Enable statistics for monitoring
StatsEnabled yes
StatsPEDisabled yes
StatsHostID auto
StatsTimeout 10

# Heuristics
HeuristicScanPrecedence yes
StructuredDataDetection yes
StructuredMinCreditCardCount 3
StructuredMinSSNCount 3

# Phishing detection
PhishingSignatures yes
PhishingScanURLs yes

# Partition intersection
PartitionIntersection no

# Detect broken executables
DetectBrokenExecutables yes

# Mail scanning
MailFollowURLs no

# Performance options
PCREMatchLimit 10000
PCRERecMatchLimit 5000
PCREMaxFileSize 100M

# Stream limits for API usage
StreamMaxLength 100M

# Fix stale socket issues
FixStaleSocket yes
