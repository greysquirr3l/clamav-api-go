# FreshClam Configuration - Optimized for Production Updates
# Optimized configuration for automated virus definition updates

# Database directory
# NOTE: Virus definitions require 1.6GB+ RAM (3.2GB during updates)
# Ensure sufficient memory allocation in Docker containers
DatabaseDirectory /var/lib/clamav

# Update log file
UpdateLogFile /var/log/clamav/freshclam.log
LogFileMaxSize 10M
LogRotate yes
LogTime yes
LogSyslog yes

# Run as user clamav
DatabaseOwner clamav

# Update mirrors - Official ClamAV database mirrors (Arch Linux optimized)
# Using recommended mirrors for better reliability
DatabaseMirror db.local.clamav.net
DatabaseMirror database.clamav.net

# DNS settings for mirror resolution - Arch Linux recommended
DNSDatabaseInfo current.cvd.clamav.net

# Update frequency - Check for updates every 2 hours (Arch Linux recommended)
# Maximum 12 checks per day to avoid being blocked by CDN
Checks 12

# Connection settings - Optimized timeouts
ConnectTimeout 60
ReceiveTimeout 60

# Retry attempts on failure
MaxAttempts 3

# Test databases after update (Arch Linux recommended)
TestDatabases yes

# Compress local database copies - disabled for faster access
# Arch Linux recommends keeping this disabled for performance
CompressLocalDatabase no

# Extra databases (uncomment if needed)
# DatabaseCustomURL http://example.com/custom.ndb

# Notification settings - notify clamd of database updates
NotifyClamd /etc/clamav/clamd.conf

# On update execute command (restart clamd)
# NOTE: For Docker deployments, systemctl is not available
# Use clamd reload signal instead
OnUpdateExecute /bin/kill -USR2 $(cat /var/run/clamav/clamd.pid)

# On error execute command
OnErrorExecute /usr/bin/logger "FreshClam update error"

# On outdated execute command  
OnOutdatedExecute /usr/bin/logger "FreshClam database outdated"

# Bytecode updates - essential for modern threat detection
Bytecode yes

# Submit statistics (optional, helps ClamAV project)
# Arch Linux recommends enabling for community benefit
SubmitDetectionStats /etc/clamav/clamd.conf

# Detection stats submission
# Set appropriate country code for statistics
DetectionStatsCountry US
DetectionStatsHostID auto

# Update process timeout
ScriptedUpdates yes

# Enable extended logging for better troubleshooting
LogVerbose no
LogTime yes

# Exclude specific mirrors if needed
# ExcludeMirror mirror.example.com

# Proxy settings (uncomment if behind proxy)
# HTTPProxyServer myproxy.example.com
# HTTPProxyPort 8080
# HTTPProxyUsername username
# HTTPProxyPassword password

# DNS settings for mirror resolution
DNSDatabaseInfo current.cvd.clamav.net

# Local IP address for outbound connections
# LocalIPAddress 192.168.1.100

# Private mirror (uncomment if using private mirror)
# PrivateMirror mirror.example.com
# DatabaseCustomURL http://mirror.example.com/path/to/database.cvd

# Safety settings
SafeBrowsing yes

# PidFile for process management
PidFile /var/run/clamav/freshclam.pid

# Foreground mode (useful for containerized deployments)
# Set to yes for Docker containers to prevent daemon detachment
Foreground yes

# Debug mode (set to yes for troubleshooting)
Debug no

# Log verbose information - keep disabled for performance
LogVerbose no

# Log rotation - already enabled above
# LogRotate yes

# Additional databases - Arch Linux recommended
# Uncomment if using Fangfrisch or unofficial signatures
# ExtraDatabase /var/lib/clamav-unofficial-sigs

# Create log file and set permissions on startup
# This ensures proper log file initialization in containers
UpdateLogFile /var/log/clamav/freshclam.log

# ==================================================================================
# ARCH LINUX OPTIMIZATIONS APPLIED
# ==================================================================================
# The following optimizations are based on Arch Linux ClamAV wiki recommendations:
#
# 1. MEMORY MANAGEMENT:
#    - Database directory configured for 1.6GB+ RAM requirement
#    - Foreground mode enabled for proper container lifecycle management
#
# 2. UPDATE FREQUENCY:
#    - 12 checks per day (every 2 hours) to avoid CDN blocking
#    - Maximum attempts limited to prevent excessive retry loops
#
# 3. CONTAINER OPTIMIZATION:
#    - Docker-compatible reload signal instead of systemctl
#    - Foreground mode prevents daemon detachment issues
#    - Proper log file initialization for containerized environments
#
# 4. SECURITY ENHANCEMENTS:
#    - SafeBrowsing enabled for additional protection
#    - Bytecode updates enabled for modern threat detection
#    - Statistics submission enabled to support ClamAV community
#
# 5. PERFORMANCE TUNING:
#    - CompressLocalDatabase disabled for faster access
#    - TestDatabases enabled for integrity verification
#    - Optimized connection timeouts for reliability
#
# For additional database sources (Fangfrisch, MalwarePatrol, etc.),
# uncomment the ExtraDatabase lines and configure accordingly.
# ==================================================================================
